---
title: "meeple-explore.Rmd"
author: "mikec964"
date: "9/28/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(readr)
library(tidyr)
```

# Explore the game, customer, and adjacent gamer data

## Reload the data
| variable            | count     | Description
| --------            |----------:| -----------
| customer            | 1         | user
| collection.customer | 160       | games in collection
| games.ratings       | 1,385,920 | for games in collection
| games.attrs         | 5954      | avg of 37 per game, 160 games
| gamers.adjacent     | 158,705   | have games in common
| gamers.selected     | 500       | subset of adjacent_gamers
| collection.selected | 80,182    | games owned by selected_gamers

```{r echo=FALSE, message=FALSE, warning=TRUE}
customer <- "mikec"
collection.customer <- read_delim("tables/collection-customer.tsv", delim = "\t", na = "NA", col_names = TRUE)
games.ratings <- read_delim("tables/games-ratings.tsv", delim = "\t", na = "NA", col_names = TRUE)
games.attrs <- read_delim("tables/games-attrs.tsv", delim = "\t", na = "NA", col_names = TRUE)
collection.selected <- read_delim("tables/collection-selected.tsv", delim = "\t", na = "NA", col_names = TRUE)
adjacent_gamers <- unique(games.ratings$gamer)
gamers.selected <- read_lines("tables/gamers-selected.tsv")
```

## Explore the customer
* What's the distribution of his/her ratings?
* Distribution of game attributes: published, #players, playtime
* Distribution of game tags: categories, mechanics
* Correlation between ratings and attributes

```{r echo=FALSE, message=TRUE, warning=TRUE}
# Only games that have been rated
games.detail <- collection.customer[!is.na(collection.customer$rating),]

ggplot(games.detail, aes(rating)) +
  geom_bar(fill="#6ec75c") +
  ggtitle("Customer Ratings of Collection")

# Do I like new games better?
g.yearpublished <- games.attrs[games.attrs$key=="yearpublished",c("game.id", "value")]
names(g.yearpublished)[-1] <- c("yearpublished")
games.detail <- left_join(games.detail, g.yearpublished, by="game.id")

published.plot <- ggplot(games.detail, aes(x=yearpublished, y=rating)) +
  ggtitle("Cutomer's Rating vs. Publish Date")
published.plot + geom_point(alpha=0.5, color="#c46c5b")
published.plot + geom_jitter(alpha=0.5, color="#c45b9f")
```

```{r echo=FALSE, message=TRUE, warning=TRUE}
# Spread attributes:
#   description, minplayers, maxplayers, playingtime, minplaytime, maxplaytime, maxplayers, comments
g.playingtime <- games.attrs[games.attrs$key=="playingtime",c("game.id", "value")]
names(g.playingtime)[-1] <- c("playingtime")
g.playingtime$playingtime <- as.integer(g.playingtime$playingtime)
games.detail <- left_join(games.detail, g.playingtime, by="game.id")

g.minage <- games.attrs[games.attrs$key=="minage",c("game.id", "value")]
names(g.minage)[-1] <- c("minage")
g.minage$minage <- as.integer(g.minage$minage)
games.detail <- left_join(games.detail, g.minage, by="game.id")

g.maxplayers <- games.attrs[games.attrs$key=="maxplayers",c("game.id", "value")]
names(g.maxplayers)[-1] <- c("maxplayers")
g.maxplayers$maxplayers <- as.integer(g.maxplayers$maxplayers)
games.detail <- left_join(games.detail, g.maxplayers, by="game.id")

ggplot(games.detail, aes(x=playingtime, y=rating)) +
  ggtitle("Cutomer's Rating vs. Playing Time") +
  geom_jitter(alpha=0.5, color="#c45b9f")
ggplot(games.detail, aes(x=maxplayers, y=rating)) +
  ggtitle("Cutomer's Rating vs. Max Players") +
  geom_jitter(alpha=0.5, color="#c45b9f")
```

```{r echo=FALSE, message=TRUE, warning=TRUE}
# Which mechanics do I prefer? (# of games per, ratings of games per)
# Which categories do I prefer?
g.mechanics <- games.attrs[games.attrs$key == "boardgamemechanic",c("game.id", "value")]
names(g.mechanics)[-1] <- c("mechanics")
mechanics.unique <- sort(unique(g.mechanics$mechanics))
g.categories <- games.attrs[games.attrs$key == "boardgamecategory",c("game.id", "value")]
names(g.categories)[-1] <- c("categories")
categories.unique <- sort(unique(g.categories$categories))

# Per mechanic, get the # of games and mean rating
mechanics.details <- data_frame(mechanic=mechanics.unique,
                                count=0,
                                mean=0.0)
#mechanics.details$count <- as.integer(0)
#mechanics.details$mean <- as.numeric(0)
for(m in g.mechanics$mechanics) {
  g <- g.mechanics[g.mechanics$mechanics == m,]
  r <- games.ratings[g$game.id, "rating"]
  mechanics.details[mechanics.details$mechanic == m,]$count <- count(g)
  mechanics.details[mechanics.details$mechanic == m,]$mean <- mean(r$rating)
}
mechanics.details$count <- as.integer(mechanics.details$count)
mechanics.details$mean <- as.numeric(mechanics.details$mean)

categories.details <- data_frame(category=categories.unique,
                                 count=0,
                                 mean=0)
for(c in g.categories$categories) {
  g <- g.categories[g.categories$categories == c,]
  r <- games.ratings[g$game.id, "rating"]
  categories.details[categories.details$category == c,]$count <- count(g)
  categories.details[categories.details$category == c,]$mean <- mean(r$rating)
}
categories.details$count <- as.integer(categories.details$count)
categories.details$mean <- as.numeric(categories.details$mean)
```

## Explore gamers
* How many games do gamers rate?
* What is distribution of their ratings?
* Distribution of game attributes: published, playtime, maxplayers

```{r echo=FALSE, message=TRUE, warning=TRUE}
# From selected gamers, find min, max, avg number of games rated
# gamers.selected is list of gamers
# collection.selected is all the games they've rated
gamers.details <- collection.selected %>% group_by(gamer) %>% count %>% arrange(n)
names(gamers.details)[-1] <- c("ratings")
print("Gamer's ratings")
summary(gamers.details$ratings)
gamers.most <- gamers.details[gamers.details$ratings >= 27,]
gamers.most <- gamers.most[gamers.most$ratings <= 168,]
ggplot(gamers.most, aes(ratings)) +
  geom_density(fill="#6ec75c") +
  ggtitle("Ratings per Gamer, 2nd-3rd quartile")

# Ratings of all adjacent gamers
ggplot(games.ratings, aes(rating)) +
  geom_bar(fill="#6ec75c") +
  ggtitle("All Ratings of Collection")
  
# group_by(gamer) %>% summarize(number of rows)

# safe bet: matrix completion
# fresh pick: graph network

```

## Explore games
* How well-known are the games (how many ratings each)?
* How well-regarded are the games (mean, sd, scatter of ratings)?
* When were the games published?
* Which game categories dominate?
* Which game mechanics dominate?
* Which game designers dominate?
* Which game publishers dominate?

